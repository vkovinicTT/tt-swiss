# Model Analysis Tool

Tool for analyzing PyTorch models to identify which modules/ops work on TT hardware.

## Architecture

```
cli.py                     # Entry point: ttchop command
â”œâ”€â”€ module_extractor.py    # Step 1: Extract unique modules from model
â”‚   â”œâ”€â”€ shapes.py          # Shape capture via forward hooks
â”‚   â””â”€â”€ data_types.py      # ModuleInfo dataclass
â”œâ”€â”€ op_by_op_runner.py     # Step 2: Run hierarchical op-by-op analysis
â”‚   â”œâ”€â”€ module_tree.py     # Tree structure (ModuleNode)
â”‚   â”œâ”€â”€ module_runner.py   # Run module through TT backend
â”‚   â””â”€â”€ ir_export_single_module.py  # Export IR in subprocess
â”œâ”€â”€ visualizer.py          # Step 3: Generate HTML report
â””â”€â”€ utils.py               # Shared utilities
```

## Key Files

| File | Purpose |
|------|---------|
| `cli.py` | Main entry point, orchestrates 3-step pipeline |
| `module_extractor.py` | Extracts unique modules based on class+shapes+params |
| `shapes.py` | Captures input/output shapes via forward hooks |
| `module_tree.py` | Builds N-ary tree from flat module list |
| `op_by_op_runner.py` | Runs op-by-op tests, marks success/failure |
| `visualizer.py` | Generates interactive HTML tree visualization |
| `utils.py` | `load_function_from_path()`, `setup_tt_device()`, `get_module_by_path()` |

## Pipeline

1. **Extract Modules** (`module_extractor.py`)
   - Load model and sample inputs
   - Run forward pass to capture shapes
   - Group modules by uniqueness key (class + shapes + params)
   - Output: `unique_modules.json`

2. **Op-by-Op Analysis** (`op_by_op_runner.py`)
   - Build tree from modules
   - For each module (lazy IR export):
     - Export IR in subprocess (cache isolation)
     - Run pytest op_by_op test
     - If passes: mark subtree as `inherited_success`
     - If fails: recurse to children
   - Update `unique_modules.json` with status

3. **Visualization** (`visualizer.py`)
   - Generate self-contained HTML with embedded CSS/JS
   - Collapsible tree with status colors
   - Output: `analysis_report.html`

## Status Values

- `success` - Module passed op-by-op (tested directly)
- `inherited_success` - Parent passed, this module inherited success
- `failed` - Op-by-op test failed
- `ir_export_failed` - Could not export IR
- `skipped` - Container module (Sequential, ModuleList, ModuleDict)

## Common Tasks

### Run Analysis
```bash
ttchop \
    --model-path path/to/model.py::load_model \
    --inputs-path path/to/model.py::get_inputs \
    --dir ./output
```

### Debug IR Export
```bash
python -m ttchop.ir_export_single_module \
    --module-id mod_000 \
    --modules-json ./output/unique_modules.json \
    --model-path model.py::load_model \
    --inputs-path model.py::get_inputs \
    --output-dir ./output
```

## Dependencies

- `torch`, `torch_xla` - Model execution on TT device
- `pytest`, `pytest-json-report` - Op-by-op testing
- No external viz dependencies (vanilla JS)


<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

### Feb 11, 2026

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #685 | 11:33 AM | ðŸ”µ | Failed ops folder feature saves MLIR modules for debugging individual op failures | ~564 |

### Feb 12, 2026

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #908 | 1:21 PM | ðŸ”µ | TTChop IR Export Single Module Script Architecture | ~465 |
| #770 | 9:20 AM | ðŸ”´ | Removed incorrect TTIR-specific highlighting parameter in visualizer | ~328 |
</claude-mem-context>